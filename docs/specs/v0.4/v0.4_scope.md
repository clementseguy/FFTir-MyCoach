# Scope v0.4

Release technique, avec outillage, refactoring, changement d'architecture, authentification et déport des calls à Mistral API

## v0.4 : Statut des développements

| ID  | Nom feature / tâche principale                            | Lot         | Priorité  | Dépendances  | Statut      |
|------|----------------------------------------------------------|-------------|-----------|--------------|-------------|
| T1  | Intégration SonarCloud                                    | Technique   | Haute     | -            | À faire     |
| T2  | Cahier de recette (tests manuels)                         | Technique   | Moyenne   | T1           | À faire     |
| T3  | Refactoring sans régression                               | Technique   | Haute     | T1, T2       | À faire     |
| T4  | Authentification via NexTarget-server                     | Technique   | Moyenne   | T3           | En cours    |
| T5  | Déport des appels Mistral API vers NexTarget-server       | Technique   | Moyenne   | T3           | À faire     |
| F1  | Règles de sécurité FFTir (révision contenu & affichage)   | Feature     | Basse     | -            | À faire     |

## Ajouts Techniques

1. Intégration SonarCloud
   - Utiliser SonarCloud connecté au dépôt GitHub.
   - Ajouter un job GitHub Actions :
       - Analyse automatique à chaque push sur `dev`
       - Analyse obligatoire sur chaque MR vers `main`
   - Critère d’acceptation : badge SonarCloud visible, note ≥ B, couverture tests ≥ 20 %.

2. Cahier de recette (tests manuels)
   - Générer automatiquement un document Markdown listant les fonctionnalités principales **existantes** de l’app.
   - Pour chaque fonctionnalité : nom, objectif, étapes de test, résultat attendu.
   - Sortie : `/docs/cahier_recette_v0.4.md`
   - Objectif : permettre à un humain de tester l’app après refactoring (vérification absence de régression).

3. Refactoring sans régression
   - Vérifier que les modèles présents dans `lib/models.dart` ne sont pas déjà dans `lib/models/*.dart`. Si c'est le cas, supprimer les modèles dans `lib/models.dart` sans perte de fonctionnalité ou erreur de compilation.
   - S’assurer que les couches UI, business et data sont séparées (aucun appel réseau direct dans les widgets).
   - Supprimer composants non utilisés (analyse statique).
   - Scinder les fichiers > 500 lignes en sous-modules cohérents.
   - Exécuter les tests unitaires existants après refactor.

4. Authentification via NexTarget-server
   - Utiliser le backend `NexTarget-server` comme provider d’authentification centralisée.
   - Auth Google d’abord (OAuth2 standard via `google_sign_in`).
   - Ensuite Facebook (via `flutter_facebook_auth`).
   - À la première connexion, faire correspondre les anciens profils locaux (UUID) avec les nouveaux comptes authentifiés.
   - Vérification post-migration : aucun utilisateur ne perd ses données (test de persistance locale et synchronisation serveur).

5. Déport des appels Mistral API vers NexTarget-server
   - Les specs API de NexTarget-Server seront communiquées
   - Le client mobile enverra :
       - l'action à exécuter (ie. à date, "analyse_session")
       - contexte (userId, Session informations)
   - Le serveur appelle Mistral API avec sa clé privée.
   - Le client ne stocke ni clé ni prompt.
   - Sécurité : appels HTTPS + token JWT utilisateur.

## Features

### Règles de sécurité

1. Feature : Règles de sécurité FFTir
   - Revoir le contenu textuel des règles dans le tableau de bord.
   - Vérifier conformité avec la charte FFTir 2024.
   - Objectif : clarté, précision et lisibilité.
