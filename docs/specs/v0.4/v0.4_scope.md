# Scope v0.4

Release technique, avec outillage, refactoring, changement d'architecture, authentification et déport des calls à Mistral API

## v0.4 : Statut des développements

| ID  | Nom feature / tâche principale                            | Lot         | Priorité  | Dépendances  | Statut      |
|------|----------------------------------------------------------|-------------|-----------|--------------|-------------|
| T1  | Intégration SonarCloud                                    | Technique   | Haute     | -            | Fait        |
| T2  | Cahier de recette (tests manuels)                         | Technique   | Moyenne   | T1           | Fait        |
| T3  | Refactoring sans régression                               | Technique   | Haute     | T1, T2       | En cours    |
| T4  | Authentification via NexTarget-server                     | Technique   | Moyenne   | T3           | A faire     |
| T5  | Déport des appels Mistral API vers NexTarget-server       | Technique   | Moyenne   | T3           | À faire     |
| F1  | Règles de sécurité FFTir (révision contenu & affichage)   | Feature     | Basse     | -            | À faire     |
| F2  | Duplication d'un Exercice                                 | Feature     | Basse     | -            | À faire     |
| F3  | Graphe d'une Session réalisée                             | Feature     | Basse     | -            | À faire     |

## Ajouts Techniques

1. Intégration SonarCloud
   - Utiliser SonarCloud connecté au dépôt GitHub.
   - Ajouter un job GitHub Actions :
       - Analyse automatique à chaque push sur `dev`
       - Analyse obligatoire sur chaque MR vers `main`
   - Critère d’acceptation : badge SonarCloud visible, note ≥ B, couverture tests ≥ 20 %.

2. Cahier de recette (tests manuels)
   - Générer automatiquement un document Markdown listant les fonctionnalités principales **existantes** de l’app.
   - Pour chaque fonctionnalité : nom, objectif, étapes de test, résultat attendu.
   - Sortie : `/docs/cahier_recette.md`
   - Objectif : permettre à un humain de tester l’app après refactoring (vérification absence de régression).

3. Refactoring sans régression
   - Vérifier que les modèles présents dans `lib/models.dart` ne sont pas déjà dans `lib/models/*.dart`. Si c'est le cas, supprimer les modèles dans `lib/models.dart` sans perte de fonctionnalité ou erreur de compilation.
   - S’assurer que les couches UI, business et data sont séparées (aucun appel réseau direct dans les widgets).
   - Supprimer composants non utilisés (analyse statique).
   - Scinder les fichiers > 500 lignes en sous-modules cohérents.
   - Exécuter les tests unitaires existants après refactor.

4. Authentification via NexTarget-server
   - Utiliser le backend `NexTarget-server` comme provider d’authentification centralisée.
   - Auth Google d’abord (OAuth2 standard via `google_sign_in`).
   - Ensuite Facebook (via `flutter_facebook_auth`).
   - À la première connexion, faire correspondre les anciens profils locaux (UUID) avec les nouveaux comptes authentifiés.
   - Vérification post-migration : aucun utilisateur ne perd ses données (test de persistance locale et synchronisation serveur).

5. Déport des appels Mistral API vers NexTarget-server
   - Les specs API de NexTarget-Server seront communiquées
   - Le client mobile enverra :
       - l'action à exécuter (ie. à date, "analyse_session")
       - contexte (userId, Session informations)
   - Le serveur appelle Mistral API avec sa clé privée.
   - Le client ne stocke ni clé ni prompt.
   - Sécurité : appels HTTPS + token JWT utilisateur.

## Features

### Règles de sécurité

1. Feature : Règles de sécurité FFTir
   - Revoir le contenu textuel des règles dans le tableau de bord. Afficher précisément :
        1. Une arme doit toujours être considérée comme chargée et prête à tirer.
        2. Une arme ne doit jamais être dirigée vers quelqu'un.
        3. Avant de manipuler une arme, on doit toujours s'assurer qu'elle est mise en sécurité (contrôles visuel et physique)
   - Objectif : clarté, précision et lisibilité.

2. Feature : Dupliquer un Exercice
   - Dupliquer : permet de créer un nouvel Exercice, copie conforme de l'exercice source
   - Bouton "dupliquer" présent dans la vue Edition, à côté du bouton Enregistrer

3. Feature : Graphe Score et Groupement dans la vue d'un Session
   - Utilisation du composant générique 'EvolutionChart'
   - Données :
      - 2 courbes : Points + Groupement de chaque série de la session
      - Pas de tendance
      - Se limite aux données des séries de la session (ni plus, ni moins)
   - Placement : au-dessus de la section du coach
   - Apparence, titre et légende : conforme avec Dashboard
   - Conditions : (il y a au moins 3 séries)