# Scope v0.4

Release technique, avec outillage, refactoring, changement d'architecture, authentification et d√©port des calls √† Mistral API

## v0.4 : Statut des d√©veloppements

| ID  | Nom feature / t√¢che principale                            | Lot         | Priorit√©  | D√©pendances  | Statut         |
|------|----------------------------------------------------------|-------------|-----------|--------------|----------------|
| T1  | Int√©gration SonarCloud                                    | Technique   | Haute     | -            | **‚úÖ FAIT**    |
| T2  | Cahier de recette (tests manuels)                         | Technique   | Moyenne   | T1           | **‚úÖ FAIT**    |
| T3  | Refactoring sans r√©gression                               | Technique   | Haute     | T1, T2       | **üü° √Ä FAIRE** |
| T4  | Authentification via NexTarget-server                     | Technique   | Moyenne   | T3           | A faire        |
| T5  | D√©port des appels Mistral API vers NexTarget-server       | Technique   | Moyenne   | T3           | √Ä faire        |
| D1  | Dashboard harmonisation et graphiques multi-courbes       | Dashboard   | Haute     | -            | **‚úÖ FAIT**    |
| D2  | Graphiques √©volution par m√©thode de prise (1/2 mains)     | Dashboard   | Haute     | D1           | **‚úÖ FAIT**    |
| D3  | Statistique "Prise dominante" (remplacement cat√©gories)   | Dashboard   | Moyenne   | D1           | **‚úÖ FAIT**    |
| F1  | R√®gles de s√©curit√© FFTir (r√©vision contenu & affichage)   | Feature     | Basse     | -            | √Ä faire        |
| F2  | Duplication d'un Exercice                                 | Feature     | Basse     | -            | √Ä faire        |
| F3  | Graphe d'une Session r√©alis√©e                             | Feature     | Basse     | D1           | √Ä faire        |

## Ajouts Techniques

1. Int√©gration SonarCloud
   - Utiliser SonarCloud connect√© au d√©p√¥t GitHub.
   - Ajouter un job GitHub Actions :
       - Analyse automatique √† chaque push sur `dev`
       - Analyse obligatoire sur chaque MR vers `main`
   - Crit√®re d‚Äôacceptation : badge SonarCloud visible, note ‚â• B, couverture tests ‚â• 20 %.

2. Cahier de recette (tests manuels)
   - G√©n√©rer automatiquement un document Markdown listant les fonctionnalit√©s principales **existantes** de l‚Äôapp.
   - Pour chaque fonctionnalit√© : nom, objectif, √©tapes de test, r√©sultat attendu.
   - Sortie : `/docs/cahier_recette.md`
   - Objectif : permettre √† un humain de tester l‚Äôapp apr√®s refactoring (v√©rification absence de r√©gression).

3. Refactoring sans r√©gression
   - **‚úÖ FAIT** : Couches UI, business et data s√©par√©es (aucun appel r√©seau direct dans les widgets)
   - **‚úÖ FAIT** : Dashboard refactoris√© avec architecture modulaire (DashboardService, composants r√©utilisables)
   - **‚úÖ FAIT** : Suppression code mort (`lib/models.dart`, `lib/screens/exercises_screen.dart`)
   - **‚úÖ FAIT** : Extraction `ExerciseFormScreen` (773L ‚Üí 480L + 304L)
   - **‚úÖ FAIT** : Modularisation `session_form.dart` (663L ‚Üí 471L + 322L components)
   - **‚úÖ FAIT** : Refactoring `planned_session_wizard.dart` (572L ‚Üí 320L + 364L wizard_steps)
   - **üü° √Ä FAIRE** : Fichiers > 500 lignes restants :
     - `session_detail_screen.dart` (556L) - Extraire sections en composants
   - **üü° √Ä FAIRE** : Analyse statique pour supprimer composants non utilis√©s
   - **üü° √Ä FAIRE** : Tests unitaires pour √©crans volumineux apr√®s refactor

4. Authentification via NexTarget-server
   - Utiliser le backend `NexTarget-server` comme provider d‚Äôauthentification centralis√©e.
   - Auth Google d‚Äôabord (OAuth2 standard via `google_sign_in`).
   - Ensuite Facebook (via `flutter_facebook_auth`).
   - √Ä la premi√®re connexion, faire correspondre les anciens profils locaux (UUID) avec les nouveaux comptes authentifi√©s.
   - V√©rification post-migration : aucun utilisateur ne perd ses donn√©es (test de persistance locale et synchronisation serveur).

5. D√©port des appels Mistral API vers NexTarget-server
   - Les specs API de NexTarget-Server seront communiqu√©es
   - Le client mobile enverra :
       - l'action √† ex√©cuter (ie. √† date, "analyse_session")
       - contexte (userId, Session informations)
   - Le serveur appelle Mistral API avec sa cl√© priv√©e.
   - Le client ne stocke ni cl√© ni prompt.
   - S√©curit√© : appels HTTPS + token JWT utilisateur.

## R√©alisations Techniques R√©centes

### Architecture Dashboard (Octobre 2025)
- **DashboardService** : Service centralis√© pour agr√©gation des donn√©es dashboard
  - M√©thodes g√©n√©riques pour √©volution par `HandMethod`
  - S√©paration claire business logic / UI
  - Couverture tests compl√®te

- **EvolutionChart Multi-courbes** :
  - Support dual-axis avec normalisation automatique
  - Architecture r√©utilisable (1 ou 2 courbes)
  - Tooltips contextuels avanc√©s
  - Th√©matisation coh√©rente (couleurs par m√©thode de prise)

- **Mod√®les de Donn√©es** :
  - `AdvancedStatsData` : Refactorisation compl√®te pour m√©triques pertinentes
  - `EvolutionData` : Support multi-courbes et dual-axis
  - `HandSpecificData` : Nouvelles donn√©es pour filtrage par m√©thode de prise

### M√©triques de Qualit√©
- **Tests** : 16/16 dashboard tests passent, couverture √©tendue
- **Architecture** : S√©paration couches respect√©e, composants r√©utilisables
- **Performance** : Optimisations calculs SMA et agr√©gations donn√©es

## Dashboard (Am√©liorations Compl√©t√©es)

### D1 : Dashboard harmonisation et graphiques multi-courbes ‚úÖ **FAIT**
- **Objectif** : Refactorisation du composant `EvolutionChart` pour supporter les graphiques multi-courbes avec dual-axis
- **R√©alisations** :
  - Architecture g√©n√©rique pour 1 ou 2 courbes simultan√©es
  - Support dual-axis (pts √† gauche, cm √† droite) avec normalisation/d√©normalisation automatique
  - Tooltips avanc√©s avec informations contextuelles (date, index s√©rie)
  - Tests complets (16/16 passent)

### D2 : Graphiques √©volution par m√©thode de prise ‚úÖ **FAIT**
- **Objectif** : Ajouter des graphiques sp√©cifiques aux m√©thodes de prise (1 main vs 2 mains)
- **R√©alisations** :
  - "Scores et Groupement - 2 mains" (courbes amber/blue)
  - "Scores et Groupement - 1 main" (courbes orangeAccent/redAccent)
  - Service g√©n√©rique `generateHandMethodEvolutionData(HandMethod)` 
  - Filtrage intelligent par `HandMethod` avec m√©thode de compatibilit√©
  - Architecture DRY avec r√©utilisation compl√®te du composant `EvolutionChart`

### D3 : Statistique "Prise dominante" ‚úÖ **FAIT**
- **Objectif** : Remplacer "Cat√©gorie dominante" par une m√©trique plus pertinente
- **R√©alisations** :
  - Mod√®le `AdvancedStatsData` refactoris√© (dominantHandMethod/dominantHandMethodPercentage)
  - Logique de calcul bas√©e sur toutes les s√©ries utilisateur avec pourcentages pr√©cis
  - Interface mise √† jour : "1 main (XX.X%)" ou "2 mains (XX.X%)"
  - Ic√¥ne appropri√©e (back_hand) et tests mis √† jour

## Features (√Ä D√©velopper)

### R√®gles de s√©curit√©

1. Feature : R√®gles de s√©curit√© FFTir
   - Revoir le contenu textuel des r√®gles dans le tableau de bord. Afficher pr√©cis√©ment :
        1. Une arme doit toujours √™tre consid√©r√©e comme charg√©e et pr√™te √† tirer.
        2. Une arme ne doit jamais √™tre dirig√©e vers quelqu'un.
        3. Avant de manipuler une arme, on doit toujours s'assurer qu'elle est mise en s√©curit√© (contr√¥les visuel et physique)
   - Objectif : clart√©, pr√©cision et lisibilit√©.

2. Feature : Dupliquer un Exercice
   - Dupliquer : permet de cr√©er un nouvel Exercice, copie conforme de l'exercice source
   - Bouton "dupliquer" pr√©sent dans la vue Edition, √† c√¥t√© du bouton Enregistrer

3. Feature : Graphe Score et Groupement dans la vue d'un Session
   - **Pr√©requis** : Utilisation du composant g√©n√©rique `EvolutionChart` (d√©j√† disponible ‚úÖ)
   - Donn√©es :
      - 2 courbes : Points + Groupement de chaque s√©rie de la session
      - Pas de tendance
      - Se limite aux donn√©es des s√©ries de la session (ni plus, ni moins)
   - Placement : au-dessus de la section du coach
   - Apparence, titre et l√©gende : conforme avec Dashboard
   - Conditions : (il y a au moins 3 s√©ries)